@using SOK.Application.Common.Helpers
@model SOK.Web.ViewModels.Home.DashboardVM
@{
    ViewData["Title"] = "Przegląd";
}

<div class="container mx-auto p-4">
    <!-- Kafelek ze statystykami zgłoszeń -->
    <div class="card bg-base-100 shadow-xl mb-8">
        <div class="card-body">
            <h2 class="card-title text-2xl mb-6">Zgłoszenia</h2>
    
            <!-- Główne statystyki -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <!-- Łącznie -->
                <div class="stat bg-base-200 rounded-lg">
                    <div class="stat-title">Łącznie</div>
                    <div class="stat-value text-primary">@Model.SubmissionsStats.TotalCount</div>
                    <div class="stat-desc flex items-center gap-2">
                        @if (Model.SubmissionsStats.TotalLast24h > 0)
                        {
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-success" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M5 10l7-7m0 0l7 7m-7-7v18" />
                            </svg>
                            <span class="text-success"><span class="font-semibold">+@Model.SubmissionsStats.TotalLast24h</span>
                                w ciągu 24h</span>
                        }
                        else
                        {
                            <span>Brak nowych w ciągu 24h</span>
                        }
                    </div>
                </div>
    
                <!-- Zgłoszenia internetowe -->
                <div class="stat bg-base-200 rounded-lg">
                    <div class="stat-title">Zgłoszenia internetowe</div>
                    <div class="stat-value text-secondary">@Model.SubmissionsStats.WebFormCount</div>
                    <div class="stat-desc flex items-center gap-2">
                        @if (Model.SubmissionsStats.WebFormLast24h > 0)
                        {
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-success" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M5 10l7-7m0 0l7 7m-7-7v18" />
                            </svg>
                            <span class="text-success"><span
                                    class="font-semibold">+@Model.SubmissionsStats.WebFormLast24h</span> w ciągu 24h</span>
                        }
                        else
                        {
                            <span>Brak nowych w ciągu 24h</span>
                        }
                    </div>
                </div>
    
                <!-- Pozostałe zgłoszenia -->
                <div class="stat bg-base-200 rounded-lg">
                    <div class="stat-title">Pozostałe</div>
                    <div class="stat-value text-accent">@Model.SubmissionsStats.OtherCount</div>
                    <div class="stat-desc flex items-center gap-2">
                        @if (Model.SubmissionsStats.OtherLast24h > 0)
                        {
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-success" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M5 10l7-7m0 0l7 7m-7-7v18" />
                            </svg>
                            <span class="text-success"><span class="font-semibold">+@Model.SubmissionsStats.OtherLast24h</span>
                                w ciągu 24h</span>
                        }
                        else
                        {
                            <span>Brak nowych w ciągu 24h</span>
                        }
                    </div>
                </div>
            </div>
    
            <!-- Wykres kolumnowy -->
            <div>
                <h3 class="text-lg font-semibold mb-4">Zgłoszenia z ostatnich 30 dni</h3>
                <div class="flex items-end justify-between h-64 gap-1">
                    @foreach (var (day, index) in Model.DailySubmissions.WithIndex())
                    {
                        var maxHeight = Model.DailySubmissions.Max(d => d.TotalCount);
                        var heightPercent = maxHeight > 0 ? (day.TotalCount * 100.0 / maxHeight) : 0;
                        var webFormHeightPercent = maxHeight > 0 ? (day.WebFormCount * 100.0 / maxHeight) : 0;
                        var otherHeightPercent = maxHeight > 0 ? (day.OtherCount * 100.0 / maxHeight) : 0;
                        var afterHalf = index >= Model.DailySubmissions.Count / 2;
    
                        <div class="h-full flex-1 flex flex-col justify-end gap-1.5">
                            @if (day.TotalCount > 0)
                            {
                                <div class="w-full relative" style="height: @(heightPercent)%;">
                                    @if (day.WebFormCount > 0)
                                    {
                                        <div class="tooltip rounded-t absolute top-0 bg-secondary w-full
                                                    @(afterHalf ? "tooltip-left" : "tooltip-right")
                                                    hover:ring-2 ring-secondary transition-shadow"
                                            style="height: @(webFormHeightPercent * 100 / heightPercent)%;">
                                            <div class="tooltip-content flex flex-col items-start">
                                                <p class="font-bold">@day.Date.ToString("dd.MM.yyyy")</p>
                                                <p class="font-medium">Internetowe: @day.WebFormCount</p>
                                                <p class="text-xs">Łącznie: @day.TotalCount</p>
                                            </div>
                                        </div>
                                    }
                                    @if (day.OtherCount > 0)
                                    {
                                        <div class="tooltip only:rounded-t absolute bottom-0 bg-accent w-full
                                                    @(afterHalf ? "tooltip-left" : "tooltip-right")
                                                    hover:ring-2 ring-accent transition-shadow"
                                            style="height: @(otherHeightPercent * 100 / heightPercent)%;">
                                            <div class="tooltip-content flex flex-col items-start">
                                                <p class="font-bold">@day.Date.ToString("dd.MM.yyyy")</p>
                                                <p class="font-medium">Inne: @day.OtherCount</p>
                                                <p class="text-xs">Łącznie: @day.TotalCount</p>
                                            </div>
                                        </div>
                                    }
                                </div>
                            }
                            else
                            {
                                <div class="w-full bg-base-300 rounded-t" style="height: 2px;"></div>
                            }
                        </div>
                    }
                </div>
    
                <!-- Legenda -->
                <div class="flex justify-center gap-6 mt-6">
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 bg-secondary rounded"></div>
                        <span class="text-sm">Internetowe</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 bg-accent rounded"></div>
                        <span class="text-sm">Inne</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>