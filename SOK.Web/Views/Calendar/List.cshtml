@using Microsoft.IdentityModel.Tokens
@using SOK.Domain.Entities.Parish;
@using SOK.Infrastructure.Extensions
@using System.Globalization
@{
    ViewData["Title"] = "Aktywuj plan";
}

@{
    var plans = ViewData["Plans"] as IEnumerable<SOK.Domain.Entities.Parish.Plan>;
}

<div class="overflow-x-auto h-full">
    @if (plans.IsNullOrEmpty())
    {
        <div class="h-full flex flex-col items-center justify-center">
            <h2 class="text-center text-xl font-semibold">
                Brak planów w systemie.
            </h2>
            <h4 class="text-center text-lg opacity-70">
                Utwórz nowy plan, aby móc go aktywować.
            </h4>
            <a asp-action="New" class="btn btn-primary mt-4">
                <i class="bi bi-plus"></i>
                Utwórz
            </a>
        </div>
    } else {
        <div class="h-full w-full flex flex-col items-center justify-start">
            <table class="table w-11/12">
                <!-- head -->
                <thead>
                    <tr>
                        <th></th>
                        <th>Nazwa</th>
                        <th>Czas utworzenia</th>
                        <th>Autor</th>
                        <th>Liczba zgłoszeń</th>
                        <th>Utworzone dnia</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                @foreach (var (plan, index) in plans!.WithIndex()) {
                    <tr class="hover:bg-base-300">
                        <th>@(index+1)</th>
                        <td>Nazwa</td>
                        <td>@plan.CreationTime.ToString("y", CultureInfo.CreateSpecificCulture("pl-PL"))</td>
                        <td>@(plan.Author?.DisplayName ?? "-")</td>
                        <td>@plan.Submissions.Count</td>
                        <td>@plan.Days.Count</td>
                        <td>
                        @if(ViewData["ActivePlanId"] as int? != plan.Id) {
                            <a asp-action="Activate" asp-route-id="@plan.Id" class="btn btn-primary btn-soft">
                                <i class="bi bi-check2"></i>
                                Aktywuj
                            </a>
                        } else {
                            <a asp-action="Deactivate" asp-route-id="@plan.Id" class="btn btn-error btn-soft">
                                <i class="bi bi-x"></i>
                                Dezaktywuj
                            </a>
                        }
                        </td>
                    </tr>
                }
                </tbody>
            </table>
        </div>
    }
</div>