---
applyTo: '/SOK.Web/Views/Calendar/**/*.cshtml,/SOK.Web/**/*Calendar*.cs'
---
Całość ma działać tak: mamy dzień kolędowy, do niego możemy przypisywać konkretne budynki w konkretnym trybie (harmonogramie). Wówczas np. w modalu ze szczegółami zgłsozenia będziemy mogli na tej podstawie sugerować, gdzie zapisać zgłoszenie, ale tylko sugerować. Ponadto budynek możemy przypisać do kilku dni (w danym harmonogramie), a wtedy wyświetla się po prostu więcej sugestii. Dodatkowo poprzez pole EnableAutoAssign w modelu BuildingAssignment możemy określić automatyczne przypisywanie nowych zgłoszeń (pasujących, tzn. w danym budynku i harmonogramie) do tego dnia (konkretnie do agendy, o tym za chwilę).

Ważne jest, że BuildingAssignment w sposób bezpośredni odpowiada głównie za sugerowanie przypisań. Rzeczywiste planowanie zgłoszeń powinno być osiągane przez model Agenda, który jest powiązany z Visits. Do agendy można przypisywać użytkowników (księży i ministrantów) i to oni będą obsługiwać wizyty w danym dniu kolędowym. W agendzie lista wizyt powinna być zawsze sortowana według kolejności wizyt (Visit.OrderNumber). Samo przypisywanie zgłoszeń powinno być możliwe na cztery sposoby: 
1. albo automatycznie po wysłaniu zgłoszenia (jeśli jest odpowiadające BuildingAssignment z włączonym EnableAutoAssign), 
2. albo z widoku szczegółów danego zgłoszenia (gdzie powinny być sugerowane odpowiednie dni), 
3. albo z poziomu edytora agendy (gdzie powinniśmy mieć pokazane wszystkie pasujące zgłoszenia, które możemy zaplanować [na podstawie BuildingAssignment], ale możemy też dodać inne zgłoszenia [w trybie wolnego dodawania, bez konieczności przypisywania całego budynku na cały dzień]), 
4. albo z poziomu modala edycji dnia kolędowego (gdzie możemy zobaczyć wszystkie zgłoszenia pasujące do przypisanych obecnie budynków i je zaplanować, lub gdy edytujemy przypisania dla danego dnia w modalu to przy zapisie mieć do wybrania opcję przypisania wszystkich pasujących zgłoszeń [lub pominięcia tego i nieprzypisania zgłoszenia]). 
W opcji pierwszej i czwartej powinniśmy przypisywać (każde) zgłoszenie do odpowiedniej agendy (tej, która ma już zaplanowane podobne zgłoszenia) w odpowiednim miejscu. W opcji drugiej powinniśmy mieć możliwość dodatkowo wyboru agendy (jeśli jest ich kilka w danym dniu), lub wybrania automatycznego, jak wyżej. W opcji drugiej i czwartej jeśli nie istnieje żadna agenda tego dnia, to powinna zostać automatycznie utworzona.
Ostatecznie w widoku dnia jeśli są jakieś nieprzypisane zgłoszenia, pasujące do tego dnia, to powinniśmy mieć jakąś ładną informację o tym (warning) i możliwość szybkiego przypisania ich do agendy (utworzonej lub istniejącej).

W kwestii agend jest jeszcze opcja przypisywania do nich księży i ministrantów oraz ustawiania pewnych flag (ShowsAssignment - czy opublikować przypisania zgłoszeń, aby ludzie widzieli że są tutaj zapisani, ShowHours - czy pokazywać godziny wizyt, ale brandowane jako "Czy agenda gotowa?"). To wszystko powinno być w edytorze agendy, razem z możliwością dodawania i usuwania wizyt oraz zmiany ich kolejności (przez drag&drop najlepiej), a także z możliwością zmiany StartHourOverride, EndHourOverride i GatheredFunds jako pól modelu. 